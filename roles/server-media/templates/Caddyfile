(logging)
{
  log /log/requests.log {
    rotate_size 50
    rotate_age  90
    rotate_keep 20
    rotate_compress
  }

  errors /log/error.log {
  	rotate_size 50
  	rotate_age  90
  	rotate_keep 20
  	rotate_compress
  }
}

(fancy_auth)
{
  jwt {
    path /
    except /favicon.ico
    except /deluge  # TODO(pbovbel) remove deluge hack, use jinja templating
    except /emby  # TODO(pbovbel) remove emby hack, use jinja templating
    allow domain bovbel.com
    allow email sean.vedell@gmail.com
    redirect /auth?backTo=https://{hostonly}{rewrite_uri}
  }
  login {
    login_path /auth
    google client_id={{ google_oauth2_client_id }},client_secret={{ google_oauth2_client_secret }},scope=https://www.googleapis.com/auth/userinfo.email
    redirect_check_referer false
  }
}

media.bovbel.com {
  import logging
  import fancy_auth

  proxy /radarr media:7878 {
    transparent
  }

  basicauth /deluge pbovbel {{ web_password }}

  proxy /deluge media:8112 {
    transparent
    without /deluge
    header_upstream X-Deluge-Base "/deluge"
  }

  proxy /sonarr media:8989 {
    transparent
  }

  proxy /tautulli media:8181 {
    transparent
  }

  proxy /jackett media:9117 {
    transparent
  }

  proxy /ombi media:3579 {
    transparent
  }

  proxy /emby media:8096 {
    transparent
  }

  # cockpit
  proxy / media:9090 {
    transparent
    websocket
    except /share  # proxy takes priority over browse
  }

  browse /share

}

router.bovbel.com {
  import logging
  import fancy_auth

  proxy / router:80 {
    transparent
    websocket
  }
}

nas.bovbel.com {
  import logging
  import fancy_auth

  proxy / nas:80 {
    transparent
    websocket
  }
}

metal.bovbel.com {
  import logging
  import fancy_auth

  proxy / metal:80 {
    transparent
    websocket
  }
}

octopi.bovbel.com {
  import logging

  basicauth / pbovbel {{ web_password }}

  proxy / octopi:80 {
    transparent
    websocket
  }
}
