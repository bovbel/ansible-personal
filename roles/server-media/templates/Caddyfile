(logging)
{
  log /log/requests.log {
    rotate_size 50
    rotate_age  90
    rotate_keep 20
    rotate_compress
  }

  errors /log/error.log {
  	rotate_size 50
  	rotate_age  90
  	rotate_keep 20
  	rotate_compress
  }
}

(fancy_auth)
{
  jwt {
    path /
    except /favicon.ico
    except /emby
    except /transmission
    allow sub pbovbel
    allow domain bovbel.com
    allow email sean.vedell@gmail.com
    redirect /auth?backTo=https://{hostonly}{rewrite_uri}
  }
  login {
    login_path /auth
    google client_id={{ google_oauth2_client_id }},client_secret={{ google_oauth2_client_secret }},scope=https://www.googleapis.com/auth/userinfo.email
    # simple pbovbel={{ web_password }}
    redirect_check_referer false
  }
}

media.bovbel.com {
  import logging
  import fancy_auth

  basicauth /transmission pbovbel {{ web_password }}

  proxy /radarr radarr:7878 {
    transparent
  }

  proxy /transmission transmission:9091 {
    transparent
  }

  proxy /sonarr sonarr:8989 {
    transparent
  }

  proxy /tautulli tautulli:8181 {
    transparent
  }

  proxy /jackett jackett:9117 {
    transparent
  }

  proxy /ombi ombi:3579 {
    transparent
  }

  proxy /emby emby:8096 {
    transparent
  }

  proxy /gui resilio:8888 {
    transparent
    websocket
  }

  redir 302 {
    if {path} is /
    / /dashboard/
  }

  # cockpit
  proxy /dashboard media:9090 {
    transparent
    websocket
  }

  browse /share

}

router.bovbel.com {
  import logging
  import fancy_auth

  proxy / router:80 {
    transparent
    websocket
  }
}

nas.bovbel.com {
  import logging
  import fancy_auth

  proxy / nas:80 {
    transparent
    websocket
  }
}

arthur-cam.bovbel.com {
  import logging
  import fancy_auth

  proxy / arthur-cam:80 {
    transparent
    websocket
  }
}

door-cam.bovbel.com {
  import logging
  import fancy_auth

  proxy / door-cam:80 {
    transparent
    websocket
  }
}

metal.bovbel.com {
  import logging
  import fancy_auth

  proxy / metal:3052 {
    transparent
    websocket
  }
}

octopi.bovbel.com {
  import logging

  basicauth / pbovbel {{ web_password }}

  proxy / octopi:80 {
    transparent
    websocket
  }
}
